<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LabAIB</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">


  <link href="./css/main.css" rel="stylesheet">

</head>
<body>
    <!-- NAVBAR -->
    <nav class="container navbar navbar-expand-lg navbar-light my-2 navbar-shadow">
      <a class="navbar-brand d-flex mx-4" href="/">
          <h4 class="my-auto"><i>Lab</i></h4>&nbsp;
          <img src="./img/logo.png" alt="" style="height: 2em;">
      </a>

      <!-- Quick links -->
      <ul id="quick-links" class="navbar-nav mx-auto"></ul>

      <!-- Icons -->
      <ul class="navbar-nav mx-4">
          <li class="nav-item">
              <a class="nav-link" href="mailto:github.aib@aib.it">
                  <i class="bi bi-envelope fs-4"></i>
              </a>
          </li>
          <li class="nav-item">
              <a class="nav-link" href="https://github.com/labaib">
                  <i class="bi bi-github fs-4"></i>
              </a>
          </li>
      </ul>
  </nav>


  <main class="container d-flex flex-column">
    <div id="dashboard" class="row g-4 my-3"></div>
    <div id="topics-container" class="my-3"></div>
    <div id="topics-list" class="mt-3"></div>
</main>

  <!--<script>

    async function renderDashboard() {
      const sections = await fetchDiscussions();
      const container = document.getElementById('dashboard');
      container.innerHTML = '';
      const categories = ['Annunci','Generale','Documentazione','Q&A','Proposte','Votazioni'];

      categories.forEach(cat => {
        const count = sections[cat] ? sections[cat].length : 0;
        const div = document.createElement('div');
        div.classList.add('col-card');
        const catClass = cat.toLowerCase().replace(/\s/g, '');
        
        // Usa categoryIcons[cat].icon e categoryIcons[cat].description
        div.innerHTML = `
          <div class="card ${catClass}" onclick="openSection('${cat}')">
            <span class="badge bg-primary badge-topics">${count}</span>
            <div class="card-body text-center">
              <div class="icon">${categoryIcons[cat].icon}</div>
              <div class="card-title mt-3">${cat}</div>
              <p class="card-text mt-1" style="font-size:1rem; color:#555;">
                ${categoryIcons[cat].description}
              </p>
            </div>
          </div>
        `;
        container.appendChild(div);
      });
    }


    async function openSection(category) {

      if (category === 'Documentazione') {
        renderDocumentationIndex();
        return;
      }
      const sections = await fetchDiscussions();
      const topics = sections[category] || [];
      currentTopics = topics;

      const optionRow = document.getElementById('option-row');
      optionRow.hidden = true;

      const container = document.getElementById('topics-container');
      container.innerHTML = `
        <div class="mb-4">
          <button class="btn btn-secondary" onclick="backToDashboard()">
            ‚Üê Torna alla Dashboard
          </button>
        </div>

        

        <div class="d-flex justify-content-between align-items-center mb-3">

          <h3 class="mb-0">${category}</h3>

          <div class="d-flex align-items-center gap-2">
            <input
              type="text"
              id="searchInput"
              class="form-control"
              style="max-width: 260px;"
              placeholder="Cerca nei topics..."
              oninput="filterTopics()"
            >

            <button class="btn btn-success text-nowrap"
              onclick="window.open(getNewDiscussionLink('${category}'), '_blank')">
              üìù ${category === 'Q&A'
                ? 'Nuova domanda'
                : category === 'Votazioni'
                ? 'Nuova votazione'
                : 'Nuova discussione'}
            </button>
          </div>

        </div>
        <hr>
        <div id="topics-list"></div>

      `;
      renderTopics(topics);
      document.getElementById('dashboard').style.display = 'none';
    }

    function renderDocumentationIndex() {
      const container = document.getElementById('topics-container');
      document.getElementById('dashboard').style.display = 'none';
      document.getElementById('option-row').hidden = true;

      container.innerHTML = `
        <div class="mb-4">
          <button class="btn btn-secondary" onclick="backToDashboard()">
            ‚Üê Torna alla Dashboard
          </button>
        </div>

        <h3>üìò Documentazione</h3>
        <p class="text-muted">Guide, tutorial e risorse curate dall‚Äôassociazione</p>

        <div class="row g-4 mt-3">
          ${renderDocCard('üìö Guide', 'doc:guida')}
          ${renderDocCard('üß© Tutorial', 'doc:tutorial')}
          ${renderDocCard('üßæ Schede / Liste', 'doc:scheda')}
          ${renderDocCard('üìê Linee guida', 'doc:linee-guida')}
          ${renderDocCard('üóÇÔ∏è Raccolte', 'doc:catalogo')}
        </div>
      `;
    }

    function renderDocCard(title, label) {
      return `
        <div class="col-md-4">
          <div class="card documentazione"
              onclick="openDocumentationType('${label}', '${title}')">
            <div class="card-body">
              <h5 class="card-title">${title}</h5>
            </div>
          </div>
        </div>
      `;
    }

    async function openDocumentationType(label, title) {
      const sections = await fetchDiscussions();
      const docs = (sections['Documentazione'] || []).filter(d =>
        d.labels.some(l => l.name === label)
      );

      currentTopics = docs;

      const container = document.getElementById('topics-container');
      container.innerHTML = `
        <div class="mb-3">
          <button class="btn btn-secondary" onclick="renderDocumentationIndex()">
            ‚Üê Torna alla Documentazione
          </button>
        </div>

        <h4>${title}</h4>
        <hr>
        <div id="topics-list"></div>
      `;

      renderTopics(docs);
    }





    function extractOggetto(body) {
      if (!body) return null;

      const match = body.match(/###\s*Oggetto dell‚Äôannuncio\s*\n+([^\n]+)/i);
      return match ? match[1].trim() : null;
    }


    function renderTopics(topics) {
      const listContainer = document.getElementById('topics-list');
      listContainer.innerHTML = '';

      if (topics.length === 0) {
        listContainer.innerHTML = '<p>Nessun topic trovato.</p>';
        return;
      }

      topics.forEach(d => {
        const oggetto = extractOggetto(d.body);

        const row = document.createElement('div');
        row.classList.add('topic-row');

        row.innerHTML = `
          <div>
            <div class="topic-title" onclick="window.open('${d.url}', '_blank')">
              ${d.title}
            </div>

            ${oggetto ? `
              <div class="topic-subject">
                ${oggetto}
              </div>
            ` : ''}
          </div>

          <div class="topic-action">
            <a href="${d.url}" target="_blank" class="btn btn-outline-primary">
              Apri
            </a>
          </div>
        `;

        listContainer.appendChild(row);
      });
    }

    function filterTopics() {
      const query = document.getElementById('searchInput').value.toLowerCase();
      const filtered = currentTopics.filter(t => 
        t.title.toLowerCase().includes(query) || t.body.toLowerCase().includes(query)
      );
      renderTopics(filtered);
    }

    function backToDashboard() {
      document.getElementById('topics-container').innerHTML = '';
      const optionRow = document.getElementById('option-row');
      optionRow.hidden = false;
      document.getElementById('dashboard').style.display = 'flex';
    }

    function getNewDiscussionLink(category) {
      const categoryMapping = {
        "Annunci": "annunci",
        "Documentazione": "documentazione",
        "Generale": "generale",
        "Proposte": "proposte",
        "Q&A": "q&a",
        "Votazioni": "votazioni"
      };
      const catName = encodeURIComponent(categoryMapping[category]);
      return `https://github.com/${OWNER}/${REPO}/discussions/new?category=${catName}`;
    }


    renderDashboard();*/
  </script>-->
  <script type="module" src="./js/main.js"></script>
</body>
</html>
